#!/usr/bin/env node

/**
 * Command line interface of {{signature.name}}.
 */

"use strict";

var program = require('commander'),
    pkg = require('../package'),
{{#if done}}    done = require('{{done}}'),
{{/if}}    {{camelcase signature.name}} = require('../lib');

program
    .version(pkg['version'])
{{#if signature.main}}    .usage('[options] {{#each signature.args}}{{#if optional}}[{{name}}{{#if multiple}}...{{/if}}]{{else}}<{{name}}{{#if multiple}} ...{{/if}}>{{/if}} {{/each}}')
{{/if}}{{#if signature.alias}}.alias({{#each signature.alias}}'{{this}}'{{#if @last}}{{else}}, {{/if}}{{/each}})
{{/if}}    .description({{#if signature.desc}}"{{{signature.desc}}}"{{else}}pkg['description']{{/if}}){{#each signature.options}}
    .option('-{{short}}, --{{name}}{{#if type}} {{#if optional}}[{{name}}]{{else}}<{{name}}>{{/if}}{{/if}}', "{{{desc}}}"){{/each}};

{{#each signature.commands}}
//=========================
// Handle `{{name}}` command
//=========================

program
    .command("{{name}}{{#each args}} {{#if optional}}[{{name}}{{#if multiple}}...{{/if}}]{{else}}<{{name}}{{#if multiple}} ...{{/if}}>{{/if}}{{/each}}")
    .description("{{{desc}}}")
{{#each options}}
    .option('-{{short}}, --{{name}}{{#if type}} {{#if optional}}[{{name}}]{{else}}<{{name}}>{{/if}}{{/if}}', "{{{desc}}}")
{{/each}}
    .action(function act({{#each args}}{{name}}, {{/each}}options) {
        {{camelcase ../signature.name}}.{{camelcase name}}({{#each args}}{{name}}, {{/each}}options, done);
    });


{{/each}}
{{#if signature.examples}}

//=========================
// Show examples
//=========================
    program.on('--help', function(){
    console.log('  Examples:');
    console.log('');
{{#each signature.examples}}    console.log('    $ {{{script}}} {{#if desc}}    # {{{desc}}}{{/if}}');
{{/each}}
    console.log('');
});

{{/if}}
program.parse(process.argv);

{{#if signature.main}}

//=========================
// Run main command
//=========================

{{#each signature.args}}{{#if @first}}var {{else}}    {{/if}}{{name}} = program.args[{{@index}}]{{#if @last}};{{else}},
{{/if}}{{/each}}
{{camelcase signature.name}}({{#each signature.args}}{{name}}, {{/each}}{
{{#each signature.options}}    {{name}}: program.{{name}}{{#if @last}}{{else}},
{{/if}}
{{/each}}

}, done);
{{/if}}
{{#if done}}{{else}}

/** When command done. */
function done(err) {
    if (err) {
        console.error(err);
        process.exit(1);
    } else {
        process.exit(0);
    }
}
{{/if}}
